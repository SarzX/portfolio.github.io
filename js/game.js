var Game=function(){this.player=$("#daniel"),this.topPos=0,this.leftPos=$(window).width()/2-this.player.width()/2,this.init()};Game.constructor=Game,Game.prototype={init:function(){this.player.css("left",this.leftPos+"px"),this.eventsHandler(),this.howToPlay(),$("nav a:first").addClass("current")},howToPlay:function(){localStorage.getItem("isYourFirstTime")||(this.lightboxInit("#howToPlay",!1),localStorage.setItem("isYourFirstTime",!1))},eventsHandler:function(){var i=this,t=this.player;$(window).resize((function(){t.css("left",$(window).width()/2-t.width()/2+"px")})),$(".road, .bridge").unbind("click").bind("click",(function(o){var s=o.pageX-t.width()/2,e=o.pageY;!0===i.canImove(s,e,!0)?(i.teleport(s,e),i.openDoors(s,e),i.revealMenu(e)):i.showNotificationsBar(notifications[0])})),$(".sea").unbind("click").bind("click",(function(t){i.showNotificationsBar(notifications[3])})),$(".house").unbind("click").bind("click",(function(){var t="#"+$(this).attr("id");i.moveDirectToHouse(t)})),$("nav a").click((function(t){t.preventDefault();var o=$(this).attr("href");return"#boat"==o?($("nav a").removeClass("current"),$(this).addClass("current"),void i.shipSail()):"#startCave"==o?($("nav a").removeClass("current"),$(this).addClass("current"),$("html, body").animate({scrollTop:0},"slow"),void i.teleport($(window).width()/2-i.player.width()/2,100)):void("#howToPlay"!=o?i.moveDirectToHouse(o):i.lightboxInit(o,!1))})),$(window).unbind("keydown").bind("keydown",(function(o){switch(i.topPos>parseFloat($("#startText").css("top"))&&$("#startText").fadeOut("fast",(function(){$(this).remove()})),o.keyCode){case 37:i.moveX(i.leftPos-5,"left"),o.preventDefault();break;case 39:i.moveX(i.leftPos+5,"right"),o.preventDefault();break;case 38:i.moveY(i.topPos-5,"up"),o.preventDefault();break;case 40:i.moveY(i.topPos+5,"down"),o.preventDefault();break;case 13:i.topPos>$("#wrapper").height()-$("#endSea").height()-t.height()&&($("nav a").removeClass("current"),$('nav a[href="#boat"]').addClass("current"),i.shipSail());break;case 27:i.hideNotificationBar();break;case 32:return!1}i.openDoors(i.leftPos,i.topPos),i.revealMenu(i.topPos)})).keyup((function(){""!=t.attr("class")&&t.removeAttr("class").destroy()})),$("#boat").unbind("click").bind("click",(function(){$("nav a").removeClass("current"),$('nav a[href="#boat"]').addClass("current"),i.shipSail()})),$("#notifications").find(".close").live("click",(function(){i.hideNotificationBar()})),$("#dark, #closeLB").die("click").live("click",(function(){i.closeLightbox()}))},showNotificationsBar:function(i){$("#notifications").css("bottom",0),$("#notifications").find(".inner").attr("id")&&$("#notifications").find(".inner").text()==i.text||$("#notifications").find(".inner").attr("id",i.type).fadeOut("fast",(function(){$(this).html('<img src="'+i.img+'" />'+i.text).fadeIn("fast")}))},hideNotificationBar:function(){$("#notifications").css("bottom","-60px")},revealMenu:function(i){i>=200?($("nav").addClass("show"),i>=350&&i<355?this.showNotificationsBar(notifications[1]):i>580&&$("#notifications").find(".inner").text()==notifications[1].text&&this.hideNotificationBar()):$("nav").removeClass("show")},teleport:function(i,t){this.topPos=t,this.leftPos=i,this.player.css({opacity:0,top:t,left:i}).show().stop(!0,!0).animate({opacity:1}),this.topPos>=200&&$("html, body").animate({scrollTop:t-200},"slow"),this.shipBack()},moveDirectToHouse:function(t){var o;for(i=0;i<houses.length;i++)if(houses[i].id==t){o=houses[i];break}var s,e=o.top+o.height-70;s=o.left&&null!=o.left?o.left+o.door.left:$(window).width()-o.width-o.right+o.door.left,this.canImove(s,e,!0)&&(this.topPos=e,this.leftPos=s,this.teleport(s,e),this.openDoors(s,e))},moveX:function(i,t){var o=this.player;this.canImove(i,null)&&(this.leftPos=i,o.animate({left:i+"px"},10)),"left"==t?this.startMoving("left",2):this.startMoving("right",3)},moveY:function(i,t){var o=this.player;this.canImove(null,i)&&(this.topPos>=200&&("up"==t?$("html, body").animate({scrollTop:$(document).scrollTop()-5},10):$("html, body").animate({scrollTop:$(document).scrollTop()+5},10)),this.topPos=i,o.animate({top:i+"px"},10)),"up"==t?this.startMoving("up",4):this.startMoving("down",1)},startMoving:function(i,t){var o=this.player;o.hasClass(i)||(o.addClass(i),o.sprite({fps:9,no_of_frames:3}).spState(t))},openDoors:function(t,o){var s=this.player,e=t||this.leftPos,a=o||this.topPos;for(i=0;i<houses.length;i++)houses[i].left&&null!=houses[i].left?a>=houses[i].top+houses[i].height-80&&a<houses[i].top+houses[i].height+s.height()&&e<houses[i].left+houses[i].width?$(houses[i].id).find(".door").addClass("open"):$(houses[i].id).find(".door").removeClass("open"):houses[i].right&&null!=houses[i].right?a>=houses[i].top+houses[i].height-80&&a<houses[i].top+houses[i].height+s.height()&&e>$(window).width()-houses[i].right-houses[i].width?$(houses[i].id).find(".door").addClass("open"):$(houses[i].id).find(".door").removeClass("open"):$(".door").removeClass("open")},inHouse:function(t,o){var s=this.player,e=[];for(i=0;i<houses.length;i++)if(o>houses[i].top&&o<houses[i].top+houses[i].height){houses[i].left&&null!=houses[i].left?t<houses[i].left+houses[i].width&&t>houses[i].left-s.width()&&o<houses[i].top+houses[i].height?t>houses[i].left+houses[i].door.left-s.width()/2&&t<houses[i].left+houses[i].door.width+houses[i].door.left-s.width()/2?(e.push(!0),o<=houses[i].top+houses[i].height-70&&this.lightboxInit(houses[i].id,!0)):e.push(!1):e.push(!0):houses[i].right&&null!=houses[i].right&&t>$(window).width()-houses[i].width-houses[i].right-s.width()&&t<$(window).width()-houses[i].right&&o<houses[i].top+houses[i].height?t>$(window).width()-houses[i].width-houses[i].right+houses[i].door.left-10&&t<$(window).width()-houses[i].right-houses[i].width+houses[i].door.left+houses[i].door.width-10?(e.push(!0),o<=houses[i].top+houses[i].height-70&&this.lightboxInit(houses[i].id,!0)):e.push(!1):e.push(!0);break}return e},isRoad:function(t,o){var s=this.player,e=$("#mainRoad"),a=!0;if(t<0||t>=parseFloat(s.parent().width())-parseFloat(s.width())||o<0||o>parseFloat(s.parent().height())-parseFloat(s.height()))a=!1;else if(t<$(window).width()/2-e.width()/2||t>$(window).width()/2+e.width()/2-s.width())for(i=0;i<roads.length;i++){if(o>roads[i].top&&o<roads[i].top+roads[i].height-s.height()){a="left"==roads[i].direction?t<$(window).width()/2+e.width()/2-s.width():"right"==roads[i].direction&&t>=$(window).width()/2+e.width()/2-s.width();break}a=!1}return a},canImove:function(i,t,o){var s=this.player,e=i||this.leftPos,a=t||this.topPos;return!("none"==s.css("display")&&!o)&&(!(this.inHouse(e,a).indexOf(!1)>=0)&&(!1!==this.isRoad(e,a)&&(!(a>$("#wrapper").height()-$("#endSea").height()-s.height())||(this.showNotificationsBar(notifications[2]),e>$(window).width()/2-$("#endBridge").width()/2&&e<$(window).width()/2+$("#endBridge").width()/2-s.width()&&!(a>$("#wrapper").height()-$("#endSea").height()+$("#endBridge").height()-70-s.height())))))},shipSail:function(){$("html, body").animate({scrollTop:$("#wrapper").height()-$("#endSea").height()+20});var i=$("#boat");this.hideNotificationBar(),this.player.stop(!0,!0).fadeOut("fast"),i.find(".meSail").delay(500).fadeIn("fast"),i.removeAttr("class").addClass("sail"),$("#contact").addClass("show")},shipBack:function(){var i=$("#boat");i.hasClass("isMoored")||(i.removeClass("sail"),i.find(".meSail").hide(),$("#contact").removeClass("show"))},lightboxInit:function(i,t){var o=this;if($("#dark").length<1){t&&($("nav a").removeClass("current"),$('nav a[href="'+i+'"]').addClass("current"));var s=$(i).find(".lightbox").html();$('<div id="dark"></div>').appendTo("body").fadeIn(),$('<div id="lightbox">'+s+'<span id="closeLB">x</span></div>').insertAfter("#dark").delay(1e3).fadeIn(),$(window).unbind("keydown"),$("#wrapper").unbind("click"),$(window).bind("keydown",(function(i){27==i.keyCode&&o.closeLightbox()}))}},closeLightbox:function(){var i=this;$("#dark, #lightbox").fadeOut("fast",(function(){i.canImove(i.leftPos,i.topPos+80)&&(i.startMoving("down",1),i.player.animate({top:i.topPos+80},(function(){i.player.removeAttr("class").destroy()})),i.topPos=i.topPos+80),$("#dark, #lightbox").remove(),i.eventsHandler(),$("html, body").animate({scrollTop:i.topPos-270})}))},putFlowers:function(){for(var i=this,t=$("#wrapper").height(),o=$(window).width(),s=0;s<20;s++){var e=Math.floor(Math.random()*o+1),a=Math.floor(Math.random()*t+1),h=[];h.push(i.isRoad(e,a)),h.push(""==i.inHouse(e,a)||i.inHouse(e,a)),h.indexOf(!1)>=0?$('<div class="flowers"></div>').appendTo("#wrapper").css({top:a,left:e}):s--}}};